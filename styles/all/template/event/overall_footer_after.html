<script>
(function($) {  // Avoid conflicts with other libraries
	"use strict";
	var last_notification = {ACTIVE_NOTIFICATION_LAST};
	var autoReloadTimer = null;
	var docTitle = document.title;
	<!-- IF UNREAD_NOTIFICATIONS_COUNT -->
	docTitle = docTitle.substr(docTitle.indexOf(')')+1);
	<!-- ENDIF -->
	function active_notifications(){
		$.getJSON("./app.php/activenotifications/" + last_notification, function (data) {
			var response = data[0];
			var unread = response.unread;
			var notifs = response.notifs;
			var output = '';
			// Let's build new notifications
			$(notifs).each(function () {
				var not = $(this)[0];
				if (not.NOTIFICATION_ID > last_notification)
				{
					last_notification = not.NOTIFICATION_ID;
				}
				var notification = '';
				if ( not.UNREAD )
				{
					notification = '<li class=" bg2">\n';
				}
				else
				{
					notification = '<li>\n';
				}
				notification = notification + '<a class="notification-block" href="' + not.U_MARK_READ + '" data-real-url="' + not.URL + '">\n';
					if (!not.AVATAR) {
						notification = notification + '<img src="{T_THEME_PATH}/images/no_avatar.gif"></img>\n';
					}
					else
					{
						notification = notification + '<img src="' + not.AVATAR + '"></img>\n';
					}
					notification = notification + '<div class="notification_text">\n';
						notification = notification + '<p class="notification-title">' + not.FORMATTED_TITLE + '</p>\n';
						notification = notification + '<p class="notification-reference">' + not.REFERENCE + '</p>\n';
						notification = notification + '<p class="notification-time">' + not.TIME + '</p>\n';
					notification = notification + '</div>\n'; 
				notification = notification + '</a>\n';
				notification = notification + '</li>\n';
				
				output = output + notification;
			});
			// Now let us add them
			$('.dropdown-contents ul li:first').before( output );
			// Change value of notification counter
			$('#notification_list_button strong').html(unread.toString());
			// Now let's set window title
			if (unread > 0)
			{
				var docTitleWithNote;
				docTitleWithNote = '(' + unread.toString() + ')' + docTitle;
				document.title = docTitleWithNote;
			}
		});
	}
	function autoReload() {
		if (autoReloadTimer) { clearTimeout(autoReloadTimer); }
		autoReloadTimer = setTimeout(function() {
			console.log(last_notification);
			active_notifications();
			autoReload();
		}, {ACTIVE_NOTIFICATION_TIME});
	}
	$(document).ready(function() {
		autoReload();
	});
})(jQuery); // Avoid conflicts with other libraries
</script>